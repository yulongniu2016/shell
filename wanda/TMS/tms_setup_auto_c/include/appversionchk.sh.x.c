#if 0
	shc Version 3.8.9b, Generic Script Compiler
	Copyright (c) 1994-2015 Francisco Rosales <frosal@fi.upm.es>

	shc -v -r -T -f tms_setup_auto_c/include/appversionchk.sh 
#endif

static  char data [] = 
#define      chk2_z	19
#define      chk2	((&data[3]))
	"\063\013\317\023\011\270\365\342\201\234\277\122\014\251\122\046"
	"\171\144\301\346\213\316\342"
#define      lsto_z	1
#define      lsto	((&data[23]))
	"\144"
#define      tst2_z	19
#define      tst2	((&data[28]))
	"\034\254\066\313\120\372\155\365\225\334\200\305\072\261\125\054"
	"\167\022\256\305\336\352\230\313\236"
#define      tst1_z	22
#define      tst1	((&data[49]))
	"\011\026\272\017\131\307\315\051\355\260\164\165\356\004\301\023"
	"\147\225\216\251\321\216\263\377\343\365"
#define      pswd_z	256
#define      pswd	((&data[129]))
	"\326\131\217\214\232\302\230\151\245\377\111\051\350\103\302\005"
	"\357\371\321\273\227\117\326\135\003\326\101\370\324\031\216\253"
	"\162\035\070\015\340\320\167\205\320\300\256\270\003\161\276\363"
	"\153\220\256\003\337\205\007\333\142\052\227\313\255\066\362\300"
	"\373\346\022\022\212\334\300\111\062\062\335\355\355\070\374\201"
	"\022\330\015\122\220\025\056\362\077\306\276\354\374\260\255\367"
	"\227\277\012\041\234\313\153\317\375\110\275\352\201\271\154\224"
	"\222\171\347\042\217\025\025\317\334\323\274\330\203\151\320\033"
	"\051\332\074\305\245\247\225\243\360\122\216\162\014\372\007\236"
	"\164\356\300\004\004\326\323\340\251\217\271\055\371\212\110\042"
	"\144\205\350\012\055\175\256\036\317\075\221\334\067\230\172\254"
	"\207\073\260\213\021\203\154\273\023\045\350\015\257\061\057\024"
	"\267\030\037\345\225\316\003\145\013\224\102\103\054\274\357\264"
	"\370\237\077\012\043\254\305\067\321\256\104\201\340\164\226\227"
	"\214\266\174\042\205\200\210\220\024\312\323\101\207\303\366\177"
	"\143\065\212\207\341\117\276\263\376\003\065\336\170\314\165\005"
	"\203\362\047\010\163\260\231\210\173\155\312\003\060\300\203\223"
	"\365\015\032\327\134\331\213\132\335\301\071\125\215\257\132\020"
	"\241\202\031\025\063\262\235\256\037\147\262\120\047\065\343\035"
	"\102\376\365\237\330\200\141\342\133\242\333\060\273\151\333\056"
	"\207\024\074\147\345\263\354\265\163\233\155\167\015\054\152\170"
	"\274\031\173\234\236\334\177\371\177\132\051"
#define      shll_z	10
#define      shll	((&data[424]))
	"\151\114\304\127\151\034\103\261\105\150\012\361"
#define      msg1_z	42
#define      msg1	((&data[441]))
	"\377\131\241\264\315\074\042\317\223\147\103\177\261\365\253\071"
	"\160\024\130\133\070\206\222\164\276\205\323\313\054\300\025\126"
	"\003\052\126\224\214\135\350\352\216\255\006\312\177\307\324\150"
	"\217\105\111\116\260\302\013\311"
#define      inlo_z	3
#define      inlo	((&data[490]))
	"\375\164\012"
#define      date_z	1
#define      date	((&data[493]))
	"\120"
#define      msg2_z	19
#define      msg2	((&data[496]))
	"\325\106\047\265\325\147\240\050\171\335\204\263\043\327\117\250"
	"\355\131\100\246\230\220\077"
#define      chk1_z	22
#define      chk1	((&data[521]))
	"\107\252\077\350\376\374\323\343\265\357\213\264\002\073\254\067"
	"\357\064\102\325\033\130\240\221\225\235\136\014\045\200\121"
#define      rlax_z	1
#define      rlax	((&data[548]))
	"\376"
#define      xecc_z	15
#define      xecc	((&data[552]))
	"\160\202\062\257\063\026\146\107\236\263\354\234\124\200\241\064"
	"\331\375\213\251\223"
#define      opts_z	1
#define      opts	((&data[570]))
	"\070"
#define      text_z	1148
#define      text	((&data[699]))
	"\073\005\132\041\114\004\140\064\142\155\131\343\277\310\262\301"
	"\372\215\214\152\020\276\366\271\122\034\344\161\030\126\040\124"
	"\134\172\165\250\176\326\335\341\104\067\304\003\000\167\304\372"
	"\005\121\144\025\020\133\317\142\167\264\324\217\013\364\343\147"
	"\157\131\017\355\060\355\317\164\044\223\170\044\013\075\036\020"
	"\216\203\046\236\336\365\001\126\252\325\345\265\312\311\035\071"
	"\042\055\046\122\032\366\307\077\211\077\143\225\174\202\245\013"
	"\006\314\251\345\302\253\073\154\201\041\042\113\353\100\204\015"
	"\341\235\205\117\025\122\126\212\171\327\316\221\241\254\247\172"
	"\371\367\163\303\047\132\135\151\010\116\221\254\052\276\366\003"
	"\300\327\213\323\017\355\364\136\365\111\073\146\042\242\102\061"
	"\206\146\271\000\366\360\071\174\030\013\341\312\071\106\011\267"
	"\336\067\264\001\142\274\215\264\007\206\076\052\001\363\133\052"
	"\267\043\163\016\122\300\133\136\107\040\151\371\017\242\360\035"
	"\370\102\275\002\150\113\243\301\101\155\347\155\166\116\230\226"
	"\110\004\031\361\101\232\131\250\145\313\122\354\261\305\005\015"
	"\237\047\251\276\171\033\343\133\242\015\060\117\252\033\364\125"
	"\001\325\220\263\107\027\262\040\001\234\114\355\174\164\103\205"
	"\336\167\171\107\236\320\132\354\236\060\111\235\251\224\322\251"
	"\006\071\104\271\231\165\003\305\002\357\007\176\315\217\274\324"
	"\015\360\027\223\332\201\263\333\021\027\111\120\114\131\235\135"
	"\176\065\077\125\356\125\352\171\332\143\205\251\135\117\250\017"
	"\246\374\276\017\353\057\323\021\340\351\210\356\312\302\340\122"
	"\111\344\201\030\223\343\273\050\242\346\251\350\022\247\124\200"
	"\034\331\263\154\047\177\233\156\025\335\031\063\152\275\015\251"
	"\273\055\252\146\350\270\273\053\055\034\122\212\325\132\047\263"
	"\004\025\166\231\233\252\076\150\311\233\117\220\322\061\150\242"
	"\302\274\212\311\212\157\014\346\027\205\276\267\015\141\006\020"
	"\332\232\211\023\256\051\160\345\000\226\230\376\266\254\154\136"
	"\010\047\003\206\265\051\150\002\270\170\155\036\364\266\113\140"
	"\272\117\221\147\311\260\374\021\105\277\035\257\236\232\162\160"
	"\176\043\111\216\147\206\277\204\223\215\000\065\325\260\243\013"
	"\363\224\176\111\041\021\022\354\271\126\064\267\043\352\154\317"
	"\102\173\076\070\264\133\260\246\227\005\227\216\365\076\226\016"
	"\216\063\041\162\076\027\100\105\242\077\064\002\054\276\263\300"
	"\275\361\150\202\256\214\117\143\264\212\144\255\176\024\201\140"
	"\112\211\350\236\237\171\346\056\125\254\104\337\032\067\112\377"
	"\207\141\363\307\162\164\300\161\056\065\115\075\261\274\327\340"
	"\130\336\141\342\351\252\154\212\007\302\060\115\111\160\017\065"
	"\113\117\307\157\342\226\175\261\010\000\166\004\351\201\050\035"
	"\172\035\016\105\264\124\002\034\164\364\253\234\161\252\221\036"
	"\074\323\202\330\163\353\020\245\155\151\127\067\354\236\177\046"
	"\303\207\226\356\376\322\113\246\005\142\267\012\032\026\343\306"
	"\107\160\174\050\276\013\121\232\302\261\234\052\372\064\063\065"
	"\316\024\274\310\276\060\223\075\154\012\360\373\352\340\300\321"
	"\037\336\244\333\370\042\106\166\152\274\046\241\336\335\220\230"
	"\066\234\375\036\070\146\242\035\265\046\117\332\151\107\304\331"
	"\221\034\236\067\373\376\321\313\206\137\351\243\010\153\110\143"
	"\312\001\357\122\163\304\024\053\047\253\226\361\211\256\376\041"
	"\015\277\223\105\206\247\235\176\176\263\354\257\331\263\143\202"
	"\305\173\360\240\061\154\252\306\270\115\251\051\233\044\346\136"
	"\217\265\130\357\304\044\205\350\155\026\144\173\113\124\012\236"
	"\010\223\366\352\215\377\355\256\123\212\370\003\143\271\034\375"
	"\264\172\365\017\064\225\070\247\326\103\332\146\266\221\345\256"
	"\055\266\216\305\136\363\335\017\201\130\107\173\026\175\027\375"
	"\270\041\145\047\043\204\374\314\175\347\366\270\200\011\220\164"
	"\362\156\344\224\341\357\055\007\205\224\252\052\240\160\372\152"
	"\033\052\327\275\324\017\064\301\077\255\265\224\337\117\060\032"
	"\320\154\074\273\007\344\251\010\045\346\365\273\036\143\074\111"
	"\247\146\111\252\010\214\267\167\371\152\124\050\234\262\316\173"
	"\165\077\117\130\052\355\002\015\266\321\001\252\023\004\032\022"
	"\121\227\272\034\341\343\176\237\101\060\264\310\262\203\330\045"
	"\061\326\342\010\231\326\022\152\256\324\012\021\262\313\043\031"
	"\075\362\041\320\244\017\111\207\145\221\001\322\065\175\312\210"
	"\135\173\265\240\150\352\153\022\315\306\363\235\164\112\261\163"
	"\005\277\013\232\133\016\171\276\020\115\057\122\274\101\203\007"
	"\365\141\005\226\356\361\152\044\253\266\243\156\244\340\112\212"
	"\265\247\173\261\164\330\122\311\221\341\124\062\345\354\076\260"
	"\013\332\000\077\332\050\117\306\210\261\216\232\374\224\170\174"
	"\013\106\145\065\217\112\064\334\145\125\204\065\113\071\341\171"
	"\123\331\175\104\354\106\120\172\123\075\364\370\241\260\256\214"
	"\113\033\044\016\067\107\120\205\110\056\107\336\170\233\356\007"
	"\345\143\156\070\342\354\260\040\101\347\272\266\221\306\350\044"
	"\227\140\221\256\272\155\355\046\222\367\127\051\100\065\344\025"
	"\121\177\321\103\344\143\276\137\250\065\002\146\121\313\257\217"
	"\257\122\300\356\254\304\252\066\371\316\371\227\356\204\302\223"
	"\147\103\367\346\223\072\055\062\222\227\307\323\274\046\046\146"
	"\275\270\031\105\023\015\323\304\057\233\121\256\160\161\250\316"
	"\326\004\127\101\346\330\354\135\011\074\064\071\023\011\240\020"
	"\356\025\331\250\037\034\374\100\377\374\201\240\155\253\140\210"
	"\241\050\307\053\147\052\300\344\255\146\357\264\062\231\231\364"
	"\104\325\141\306\366\203\021\341\304\225\357\061\101\120\271\342"
	"\170\201\015\340\254\316\305\131\064\264\015\146\116\247\133\223"
	"\174\274\131\163\100\152\125\004\000\104\066\101\225\357\044\016"
	"\161\061\356\035\000\263\167\064\150\204\233\267\054\367\112\250"
	"\263\243\033\364\016\161\370\017\265\057\120\113\037\164\131\220"
	"\246\107\255\246\373\044\333\144\251\167\033\326\156\146\176\042"
	"\012\232\026\031\013\017\050\301\076\170\014\135\355\146\355\223"
	"\255\233\072\251\300\026\016\152\216\051\100\374\220\277\037\232"
	"\131\065\263\145\105\333\047\203\124\064\341\101\232\317\325\110"
	"\152\020\361\053\047\000\225\265\052\325\262\272\224\321\125\356"
	"\006\010\124\114\344\173\320\071\260\261\172\112\200\120\222\353"
	"\141"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
