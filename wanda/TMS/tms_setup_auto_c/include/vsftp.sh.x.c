#if 0
	shc Version 3.8.9b, Generic Script Compiler
	Copyright (c) 1994-2015 Francisco Rosales <frosal@fi.upm.es>

	shc -v -r -T -f tms_setup_auto_c/include/vsftp.sh 
#endif

static  char data [] = 
#define      chk2_z	19
#define      chk2	((&data[0]))
	"\170\342\332\014\034\016\307\157\127\043\265\325\174\047\142\332"
	"\207\145\227\345\162"
#define      pswd_z	256
#define      pswd	((&data[41]))
	"\073\225\372\336\012\117\266\024\211\141\153\343\332\330\136\031"
	"\320\154\220\274\075\333\257\370\000\256\257\041\022\173\217\002"
	"\267\004\020\265\040\252\151\314\254\351\075\342\143\235\055\123"
	"\057\144\347\154\077\226\145\077\105\025\141\127\220\361\132\107"
	"\365\153\375\026\025\147\342\302\120\040\245\264\275\323\010\354"
	"\067\357\131\167\206\276\267\313\323\030\043\144\012\175\253\377"
	"\350\250\025\376\017\370\301\140\030\146\025\326\071\035\303\161"
	"\014\035\351\223\333\240\136\257\271\201\023\303\377\276\302\347"
	"\147\330\346\167\321\247\330\352\015\355\301\107\012\204\271\027"
	"\242\242\252\175\102\011\055\373\212\100\276\212\377\201\161\147"
	"\131\127\337\053\377\267\025\014\244\326\124\256\133\015\306\375"
	"\257\160\173\362\171\250\355\004\351\254\216\351\055\000\121\207"
	"\130\060\263\127\347\310\144\214\236\271\072\372\306\001\367\166"
	"\161\163\150\353\034\126\357\005\003\176\357\060\177\100\270\330"
	"\161\153\060\130\064\224\344\323\116\037\315\024\040\305\213\222"
	"\071\364\175\125\112\155\133\115\354\112\176\154\213\067\104\374"
	"\243\164\125\327\011\072\253\127\132\170\154\172\076\367\015\167"
	"\354\213\314\066\367\135\363\357\205\170\324\370\174\045\365\267"
	"\273\357\226\305\077\115\331\310\257\105\254\212\036\013\243\356"
	"\167\064\253\156\222\237\136\027\027\062\017\223\130\005\113\024"
	"\365\342\331\064\057\263\375\337\371\252\151\027\265\015\006\055"
	"\101\261\233\324"
#define      inlo_z	3
#define      inlo	((&data[361]))
	"\216\125\034"
#define      lsto_z	1
#define      lsto	((&data[364]))
	"\067"
#define      msg1_z	42
#define      msg1	((&data[370]))
	"\107\231\367\052\163\247\010\302\375\054\254\362\207\140\164\347"
	"\007\165\162\044\210\076\142\067\012\123\031\167\045\335\205\011"
	"\055\301\077\115\264\057\220\224\012\157\074\212\146\232\106"
#define      date_z	1
#define      date	((&data[412]))
	"\074"
#define      shll_z	10
#define      shll	((&data[413]))
	"\211\357\004\050\171\112\163\031\230\167"
#define      text_z	1102
#define      text	((&data[598]))
	"\212\257\075\267\361\356\122\305\077\114\262\247\170\256\243\376"
	"\260\353\227\247\025\012\323\157\061\375\250\121\322\112\210\134"
	"\372\305\023\354\264\145\262\364\262\144\233\053\022\077\051\302"
	"\053\301\152\100\313\076\260\375\073\130\116\016\243\326\152\236"
	"\234\175\212\121\343\074\105\225\241\340\300\263\040\352\166\113"
	"\253\340\214\167\036\075\164\132\225\302\150\071\231\322\327\066"
	"\120\142\207\063\237\314\311\100\255\212\364\316\164\152\031\040"
	"\112\246\227\151\343\013\303\171\316\054\263\147\376\212\236\117"
	"\355\045\203\214\362\114\315\237\327\301\155\114\053\207\154\166"
	"\056\003\337\021\017\243\213\335\317\076\104\316\311\342\035\266"
	"\010\240\103\372\355\021\232\305\322\007\021\376\217\175\165\237"
	"\102\234\064\350\177\376\202\214\342\350\252\065\370\116\362\366"
	"\273\235\151\021\276\314\072\044\333\327\212\142\322\061\221\020"
	"\145\340\343\050\311\210\144\200\255\157\150\140\131\015\052\216"
	"\230\140\077\376\013\026\264\210\012\124\023\020\055\365\215\115"
	"\047\121\172\170\120\153\032\262\345\120\003\033\260\007\037\111"
	"\126\216\157\253\074\154\021\132\277\151\253\367\153\072\365\354"
	"\361\052\225\214\271\314\115\365\072\011\367\320\072\210\030\046"
	"\123\027\200\237\361\144\256\130\233\105\207\172\275\051\057\145"
	"\066\257\133\244\131\030\210\131\372\161\242\253\050\125\050\340"
	"\066\265\313\125\014\250\154\014\242\121\112\376\133\075\130\334"
	"\017\232\264\227\150\164\176\145\323\130\002\251\334\150\165\031"
	"\321\335\235\350\042\272\036\255\276\206\016\315\016\323\170\372"
	"\245\116\023\330\244\005\310\362\137\207\213\205\371\077\162\062"
	"\145\241\071\112\246\322\167\075\172\113\072\300\352\004\043\357"
	"\262\371\332\020\016\351\333\240\142\277\260\252\306\322\120\326"
	"\217\365\342\107\004\073\007\234\262\223\301\252\377\033\127\025"
	"\073\024\362\143\202\274\151\277\237\234\032\257\167\237\173\125"
	"\071\234\215\364\130\207\062\156\064\312\340\276\352\014\064\223"
	"\275\071\103\106\000\303\113\052\302\133\265\166\024\330\055\077"
	"\250\301\136\132\144\327\207\005\075\055\277\250\246\125\244\252"
	"\034\007\327\245\144\205\373\277\223\322\005\102\054\105\167\125"
	"\265\244\252\066\253\072\321\340\037\217\176\037\371\206\171\276"
	"\277\214\175\111\140\212\372\062\375\263\371\173\226\232\244\340"
	"\236\040\034\120\336\355\024\013\350\043\067\007\113\165\222\113"
	"\373\110\224\050\272\107\253\025\177\206\003\272\211\341\011\023"
	"\300\141\223\007\057\201\170\362\133\236\363\237\106\377\141\012"
	"\133\222\366\165\250\025\241\233\373\107\347\264\002\321\270\316"
	"\260\166\245\120\130\252\216\306\114\102\367\112\146\261\141\227"
	"\334\070\001\275\205\350\252\255\313\231\013\202\325\015\252\353"
	"\157\137\063\132\132\201\344\004\117\230\246\263\302\244\167\253"
	"\374\333\267\040\123\320\214\145\136\362\114\041\210\025\122\264"
	"\220\365\220\063\134\351\023\046\044\052\102\350\032\360\370\102"
	"\047\332\160\173\176\172\214\035\021\105\050\342\064\374\345\050"
	"\265\350\065\241\304\124\264\213\000\251\035\264\352\131\170\057"
	"\135\104\077\361\310\164\012\365\354\247\104\377\360\225\352\273"
	"\174\012\172\160\037\112\140\062\102\204\350\324\250\347\211\317"
	"\321\175\375\377\357\271\351\136\230\327\121\244\173\171\004\317"
	"\031\360\040\063\302\325\035\204\226\374\072\330\017\010\163\264"
	"\333\146\175\001\101\332\374\227\336\065\350\240\175\063\034\275"
	"\062\305\133\064\233\161\255\047\320\040\303\313\364\104\342\375"
	"\225\076\367\341\121\153\357\274\305\330\027\317\022\207\155\021"
	"\256\065\120\105\130\364\371\326\301\366\247\143\320\041\321\032"
	"\045\114\050\230\172\327\117\352\034\153\312\271\163\053\026\107"
	"\222\034\342\142\107\340\176\270\255\025\343\036\060\003\054\125"
	"\264\253\223\107\267\127\345\346\227\134\132\214\205\330\041\310"
	"\166\012\020\161\376\115\045\326\364\104\304\005\115\055\317\145"
	"\166\157\272\317\155\065\042\261\131\004\315\143\266\072\356\304"
	"\377\274\026\014\261\302\305\076\056\113\044\231\325\046\117\043"
	"\330\066\241\347\021\044\252\053\031\224\365\355\354\345\346\342"
	"\346\214\257\375\212\334\030\065\244\203\214\276\217\137\325\024"
	"\136\043\040\130\175\255\270\133\323\271\013\025\110\007\156\100"
	"\275\146\237\013\102\046\112\042\027\212\075\142\303\326\151\246"
	"\346\264\254\366\242\213\010\075\115\265\164\363\344\031\244\277"
	"\313\115\170\236\377\246\176\350\231\174\077\332\125\272\200\247"
	"\067\212\210\141\367\134\356\340\203\155\170\002\050\014\135\160"
	"\361\117\340\310\154\060\016\014\176\056\315\131\010\331\344\232"
	"\163\356\071\344\203\163\322\256\070\374\375\060\271\312\031\042"
	"\206\361\257\166\256\325\206\016\123\350\060\355\046\137\350\331"
	"\374\366\042\142\270\123\211\047\056\103\354\176\212\344\203\030"
	"\252\254\162\155\076\345\360\317\300\133\352\326\177\020\340\052"
	"\211\366\320\321\321\225\275\073\165\320\205\124\245\265\243\172"
	"\136\327\142\351\303\341\377\245\215\074\142\317\157\346\141\122"
	"\016\177\337\314\246\021\105\002\157\213\364\106\273\367\034\013"
	"\337\160\174\125\074\321\363\065\226\163\341\301\023\016\143\035"
	"\011\164\056\154\345\123\244\244\124\301\162\053\036\362\227\021"
	"\334\277\273\172\105\242\251\072\152\005\040\036\351\211\233\202"
	"\072\214\154\115\127\107\371\131\121\234\241\321\121\327\124\366"
	"\277\367\124\364\360\170\205\377\052\270\310\025\156\264\202\130"
	"\226\331\321\123\007\151\272\131\167\127\333\040\315\275\201\125"
	"\317\220\371\132\155\310\230\262\227\141\225\264\030\236\125\133"
	"\230\103\155\062\010\077\072\031\076\312\227\264\207\031\011\126"
	"\251\002\260\027\313\111\312\142\252\137\027\302\375\154\036\226"
	"\260\214\311\270\313\004\322\012"
#define      tst2_z	19
#define      tst2	((&data[1761]))
	"\125\203\017\146\113\041\133\374\167\317\200\354\331\060\257\254"
	"\062\157\025\247\047\310\254\055"
#define      opts_z	1
#define      opts	((&data[1783]))
	"\303"
#define      chk1_z	22
#define      chk1	((&data[1787]))
	"\372\120\156\366\050\363\263\052\345\124\321\271\322\257\111\301"
	"\031\274\213\051\276\047\001\336\211"
#define      xecc_z	15
#define      xecc	((&data[1809]))
	"\013\015\245\123\364\276\045\241\027\051\365\153\234\162\372\176"
#define      tst1_z	22
#define      tst1	((&data[1825]))
	"\202\225\141\364\157\131\041\137\321\274\107\375\162\364\204\310"
	"\206\030\253\052\010\026\276"
#define      msg2_z	19
#define      msg2	((&data[1852]))
	"\320\272\225\236\162\344\347\346\112\214\372\056\176\305\356\263"
	"\260\214\023\365\250\102\054\044\124"
#define      rlax_z	1
#define      rlax	((&data[1873]))
	"\374"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
